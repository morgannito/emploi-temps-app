<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Emploi du Temps</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/admin.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-calendar-alt me-2"></i>
                Gestion Emploi du Temps
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-user me-1"></i>
                    Administration
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Onglets pour les jours -->
        <ul class="nav nav-tabs" id="dayTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="lundi-tab" data-bs-toggle="tab" data-bs-target="#lundi" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i>Lundi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="mardi-tab" data-bs-toggle="tab" data-bs-target="#mardi" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i>Mardi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="mercredi-tab" data-bs-toggle="tab" data-bs-target="#mercredi" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i>Mercredi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="jeudi-tab" data-bs-toggle="tab" data-bs-target="#jeudi" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i>Jeudi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="vendredi-tab" data-bs-toggle="tab" data-bs-target="#vendredi" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i>Vendredi
                </button>
            </li>
        </ul>

        <!-- Contenu des onglets -->
        <div class="tab-content" id="dayTabsContent">
            {% for day in ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi'] %}
            <div class="tab-pane fade {% if day == 'lundi' %}show active{% endif %}" id="{{ day }}" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-table me-2"></i>
                            Emploi du temps - {{ day.title() }}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover schedule-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th width="120">Horaires</th>
                                        {% for room_id, room in rooms.items() %}
                                        <th class="text-center">
                                            {{ room.name }}
                                            <small class="d-block text-muted">{{ room.capacity }} places</small>
                                        </th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set time_slots = [
                                        ('08:00', '09:00'),
                                        ('09:00', '10:00'),
                                        ('10:15', '11:15'),
                                        ('11:15', '12:15'),
                                        ('13:30', '14:30'),
                                        ('14:30', '15:30'),
                                        ('15:45', '16:45'),
                                        ('16:45', '17:45'),
                                        ('17:45', '18:00')
                                    ] %}
                                    {% for slot_index in range(time_slots|length) %}
                                    {% set start_time, end_time = time_slots[slot_index] %}
                                    <tr>
                                        <td class="time-slot">
                                            <strong>{{ start_time }}</strong><br>
                                            <small>{{ end_time }}</small>
                                        </td>
                                        {% for room_id, room in rooms.items() %}
                                        <td class="schedule-cell" 
                                            data-day="{{ day }}" 
                                            data-room="{{ room_id }}" 
                                            data-slot="{{ slot_index }}">
                                            <div class="schedule-content">
                                                <div class="duration-select mb-1">
                                                    <select class="form-select form-select-sm duration-dropdown" 
                                                            data-field="duration">
                                                        <option value="">Durée</option>
                                                        <option value="1">1h</option>
                                                        <option value="1.5">1h30</option>
                                                        <option value="2">2h</option>
                                                        <option value="3">3h</option>
                                                        <option value="4">4h</option>
                                                    </select>
                                                </div>
                                                <div class="teacher-select">
                                                    <select class="form-select form-select-sm teacher-dropdown" 
                                                            data-field="teacher">
                                                        <option value="">Aucun professeur</option>
                                                        {% for teacher_id, teacher in teachers.items() %}
                                                        <option value="{{ teacher_id }}">{{ teacher.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="subject-input mt-1">
                                                    <input type="text" 
                                                           class="form-control form-control-sm subject-field" 
                                                           placeholder="Matière" 
                                                           data-field="subject">
                                                </div>
                                                <div class="equipment-select mt-1">
                                                    <select class="form-select form-select-sm equipment-dropdown" 
                                                            multiple 
                                                            data-field="equipment">
                                                        {% for equipment_id, equip in equipment.items() %}
                                                        <option value="{{ equipment_id }}">{{ equip.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Modal pour les détails -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Détails du créneau</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modalContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" id="saveChanges">Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast pour notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    
    <!-- Données pour JavaScript -->
    <script>
        window.scheduleData = {{ schedule | tojson | safe }};
        window.teachersData = {{ teachers | tojson | safe }};
        window.roomsData = {{ rooms | tojson | safe }};
        window.equipmentData = {{ equipment | tojson | safe }};
    </script>
</body>
</html> 